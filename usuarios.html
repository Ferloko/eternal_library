<!DOCTYPE HTML>
<html>

<head>
	<title>Usuarios - Biblioteca Digital</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<noscript>
		<link rel="stylesheet" href="assets/css/noscript.css" />
	</noscript>
	<link rel="icon" type="image/png" href="images/logo.png">

</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header -->
		<header id="header">
			<a href="index.html" class="logo">Biblioteca Digital</a>
		</header>

		<!-- Nav -->
		<nav id="nav">
			<ul class="links">
				<li><a href="index.html">Inicio</a></li>
				<li><a href="generic.html">Clases</a></li>
				<li class="active"><a href="usuarios.html">Usuarios</a></li>
				<li><a href="libros.html">Libros</a></li>
				<li><a href="bibliotecarios.html">Bibliotecarios</a></li>
				<li><a href="prestamos.html">Préstamos</a></li>
			</ul>
			<ul class="icons">
				<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
				<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
				<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
			</ul>
		</nav>

		<!-- Main -->
		<div id="main">

			<!-- Post -->
			<section class="post">
				<header class="major">
					<h1>Gestión de Usuarios</h1>
					<p>Administra los usuarios registrados en el sistema de biblioteca</p>
				</header>

				<!-- Formulario de Usuarios -->
				<div class="row gtr-uniform">
					<div class="col-6 col-12-xsmall">
						<label for="usuario-id">ID Usuario</label>
						<input type="text" name="usuario-id" id="usuario-id" value="" placeholder="ID (automático)"
							disabled />
					</div>
					<div class="col-6 col-12-xsmall">
						<label for="usuario-nombre">Nombre</label>
						<input type="text" name="usuario-nombre" id="usuario-nombre" value=""
							placeholder="Nombre del usuario" />
					</div>
					<div class="col-6 col-12-xsmall">
						<label for="usuario-apellido">Apellido</label>
						<input type="text" name="usuario-apellido" id="usuario-apellido" value=""
							placeholder="Apellido del usuario" />
					</div>
					<div class="col-6 col-12-xsmall">
						<label for="usuario-email">Email</label>
						<input type="email" name="usuario-email" id="usuario-email" value=""
							placeholder="usuario@ejemplo.com" />
					</div>
					<div class="col-6 col-12-xsmall">
						<label for="usuario-telefono">Teléfono</label>
						<input type="text" name="usuario-telefono" id="usuario-telefono" value=""
							placeholder="+56 9 1234 5678" />
					</div>
					<div class="col-6 col-12-xsmall">
						<label for="usuario-estado">Estado</label>
						<select name="usuario-estado" id="usuario-estado">
							<option value="activo">Activo</option>
							<option value="inactivo">Inactivo</option>
							<option value="suspendido">Suspendido</option>
						</select>
					</div>
					<div class="col-12">
						<hr>
						<ul class="actions">
							<li><input type="button" value="Nuevo" class="primary" onclick="nuevoUsuario()" /></li>
							<li><input type="button" value="Guardar" class="primary" onclick="guardarUsuario()" /></li>
							<li><input type="button" value="Eliminar" class="button" onclick="eliminarUsuario()" /></li>
						</ul>
					</div>
				</div>

				<!-- Tabla de usuarios -->
				<h3>Usuarios Registrados</h3>
				<div class="table-wrapper">
					<table id="tabla-usuarios" class="alt">
						<thead>
							<tr>
								<th>ID</th>
								<th>Nombre</th>
								<th>Apellido</th>
								<th>Email</th>
								<th>Teléfono</th>
								<th>Estado</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody>
							<!-- Los datos se cargarán dinámicamente con JavaScript -->
						</tbody>
					</table>
				</div>
			</section>

		</div>

		<!-- Footer -->
		<footer id="footer">
			<section>
				<h2>¿Necesitas ayuda?</h2>
				<p>Si tienes alguna pregunta sobre la gestión de usuarios, no dudes en contactar a nuestro equipo de
					soporte.</p>
				<ul class="actions">
					<li><a href="index.html#footer" class="button">Contáctanos</a></li>
				</ul>
			</section>
			<section class="split contact">
				<section class="alt">
					<h3>Dirección</h3>
					<p>Av. Principal #1234<br />
						Santiago, Región Metropolitana<br />
						Chile</p>
				</section>
				<section>
					<h3>Teléfono</h3>
					<p><a href="tel:+56221234567">(2) 2123 4567</a></p>
				</section>
				<section>
					<h3>Email</h3>
					<p><a href="mailto:usuarios@bibliotecadigital.cl">usuarios@bibliotecadigital.cl</a></p>
				</section>
			</section>
		</footer>

		<!-- Copyright -->
		<div id="copyright">
			<ul>
				<li>&copy; 2025 Biblioteca Raices Eternas. Creado por Rafa #22 y Yani #15 - 6to DAAI</li>
				<li>Diseño: <a href="https://html5up.net">HTML5 UP</a></li>
			</ul>
		</div>

	</div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.scrollex.min.js"></script>
	<script src="assets/js/jquery.scrolly.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

<!--  <h1> Autores: </h1>

                                                                    :=:                  
                                                                 :*+=-+*                  
                                                                -@-                       
                                                                %@                        
                                                                @%                        
                                                               .@*              .         
                         .:-==++++==:.                         :@*        :**++@@:        
                  .-+++++--::.::--+*%@@*:                 .:---+@#***+=-+%#=-:-@%         
              .=**=:     #@          .=@@+     .:-------=-:.=*##@#:.   .@*    #@-         
           :+%*-         @@            -@@+==--:.  -*++#@@  :. :@=     #@.   :@@:         
         -%@+            @@    .:-=---:.*@.      =%=   #@#     -@=    .@#    *@@:         
        =@%             .@%-===-.      .@=      :@+    @@.     -@- .:-*@*===**%@:   .     
        %@-         .-=-=@%           -%-       %@    -@@     .+@+--:.+@.  -+ %@+-.=      
        -@*.   .-==-:   :@*        .=#=        :@+    #@@  -==:+@:    +@. =+  *@%*+       
          +%**+:        -@=    .-+*+:          +@.   +-@@=-..  +@:    =@##=    =-         
       :==:. .-:       =+@=-+++=:              #@   +--@@. .=  *@.     ++.                
    :+=.               *@@#:.                  %%  ++:=@@*=-   #@.                        
  :=:                   %%%%+:               ::#@=*= + =*=.    %@                         
 =:                    .@= .+%%+:             #-#*:  =         @#                         
 -                     -@.    .=%@#=.         =-      -*      -@-                         
                       #*         -+%@*=:     =:       #%=-: .%=                          
     ..               :@.            .-+#%%%#*-        .#@++#+=---::..              ..:-=.
     .%               %+                                  ..       .::--===========--:.   
      +%.            **                                                                   
       +@+          *+                                                                    
        .*@*=:   .=#-                                                                     
           :=*#%#*-    
-->

</body>

</html>

	<script>
		const API_URL = 'http://localhost:3000/api/usuarios';

		document.addEventListener("DOMContentLoaded", function () {
			cargarUsuarios();
		});

		async function cargarUsuarios() {
			try {
				const response = await fetch(API_URL);
				if (!response.ok) throw new Error('Error al cargar usuarios');
				
				const usuarios = await response.json();
				var tbody = document.querySelector("#tabla-usuarios tbody");
				tbody.innerHTML = "";

				usuarios.forEach(function (usuario) {
					var tr = document.createElement("tr");
					tr.innerHTML = `
							<td>${usuario._id}</td>
							<td>${usuario.nombre || ''}</td>
							<td>${usuario.apellido || ''}</td>
							<td>${usuario.email || ''}</td>
							<td>${usuario.telefono || ''}</td>
							<td>${usuario.estado || 'activo'}</td>
							<td>
								<button class="button small" onclick="editarUsuario('${usuario._id}')">Editar</button>
								<button class="button small" onclick="eliminarUsuario('${usuario._id}')">Eliminar</button>
							</td>
						`;
					tbody.appendChild(tr);
				});
			} catch (error) {
				console.error('Error:', error);
				alert('Error al cargar los usuarios');
			}
		}

		function nuevoUsuario() {
			document.getElementById("usuario-id").value = "";
			document.getElementById("usuario-nombre").value = "";
			document.getElementById("usuario-apellido").value = "";
			document.getElementById("usuario-email").value = "";
			document.getElementById("usuario-telefono").value = "";
			document.getElementById("usuario-estado").value = "activo";
		}

		async function guardarUsuario() {
			const id = document.getElementById("usuario-id").value;
			const usuario = {
				nombre: document.getElementById("usuario-nombre").value,
				apellido: document.getElementById("usuario-apellido").value,
				email: document.getElementById("usuario-email").value,
				telefono: document.getElementById("usuario-telefono").value,
				estado: document.getElementById("usuario-estado").value || 'activo'
			};

			if (!usuario.nombre || !usuario.email) {
				alert("Por favor complete los campos obligatorios (Nombre y Email)");
				return;
			}

			try {
				const url = id ? `${API_URL}/${id}` : API_URL;
				const method = id ? 'PUT' : 'POST';

				const response = await fetch(url, {
					method: method,
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(usuario)
				});

				if (!response.ok) throw new Error('Error al guardar el usuario');

				alert(`Usuario ${id ? 'actualizado' : 'guardado'} correctamente`);
				cargarUsuarios();
				nuevoUsuario();
			} catch (error) {
				console.error('Error:', error);
				alert('Error al guardar el usuario');
			}
		}

		async function eliminarUsuario(id) {
			if (!id) {
				alert("Seleccione un usuario para eliminar");
				return;
			}

			if (!confirm("¿Está seguro de eliminar este usuario?")) {
				return;
			}

			try {
				const response = await fetch(`${API_URL}/${id}`, {
					method: 'DELETE'
				});

				if (!response.ok) throw new Error('Error al eliminar el usuario');

				alert("Usuario eliminado correctamente");
				cargarUsuarios();
				nuevoUsuario();
			} catch (error) {
				console.error('Error:', error);
				alert('Error al eliminar el usuario');
			}
		}

		async function editarUsuario(id) {
			try {
				const response = await fetch(`${API_URL}/${id}`);
				if (!response.ok) throw new Error('Error al cargar el usuario');

				const usuario = await response.json();

				document.getElementById("usuario-id").value = usuario._id;
				document.getElementById("usuario-nombre").value = usuario.nombre || '';
				document.getElementById("usuario-apellido").value = usuario.apellido || '';
				document.getElementById("usuario-email").value = usuario.email || '';
				document.getElementById("usuario-telefono").value = usuario.telefono || '';
				document.getElementById("usuario-estado").value = usuario.estado || 'activo';
			} catch (error) {
				console.error('Error:', error);
				alert('Error al cargar los datos del usuario');
			}
		}
	</script>

<!--  <h1> Autores: </h1>

                                                                    :=:                  
                                                                 :*+=-+*                  
                                                                -@-                       
                                                                %@                        
                                                                @%                        
                                                               .@*              .         
                         .:-==++++==:.                         :@*        :**++@@:        
                  .-+++++--::.::--+*%@@*:                 .:---+@#***+=-+%#=-:-@%         
              .=**=:     #@          .=@@+     .:-------=-:.=*##@#:.   .@*    #@-         
           :+%*-         @@            -@@+==--:.  -*++#@@  :. :@=     #@.   :@@:         
         -%@+            @@    .:-=---:.*@.      =%=   #@#     -@=    .@#    *@@:         
        =@%             .@%-===-.      .@=      :@+    @@.     -@- .:-*@*===**%@:   .     
        %@-         .-=-=@%           -%-       %@    -@@     .+@+--:.+@.  -+ %@+-.=      
        -@*.   .-==-:   :@*        .=#=        :@+    #@@  -==:+@:    +@. =+  *@%*+       
          +%**+:        -@=    .-+*+:          +@.   +-@@=-..  +@:    =@##=    =-         
       :==:. .-:       =+@=-+++=:              #@   +--@@. .=  *@.     ++.                
    :+=.               *@@#:.                  %%  ++:=@@*=-   #@.                        
  :=:                   %%%%+:               ::#@=*= + =*=.    %@                         
 =:                    .@= .+%%+:             #-#*:  =         @#                         
 -                     -@.    .=%@#=.         =-      -*      -@-                         
                       #*         -+%@*=:     =:       #%=-: .%=                          
     ..               :@.            .-+#%%%#*-        .#@++#+=---::..              ..:-=.
     .%               %+                                  ..       .::--===========--:.   
      +%.            **                                                                   
       +@+          *+                                                                    
        .*@*=:   .=#-                                                                     
           :=*#%#*-    
-->

</body>

</html>